#+TITLE: Diseño e implementación de una arquitectura modular para la modernización y unificación de extensiones en GNOME Shell 50
#+DATE: 17-02-2026
* 1. Resumen técnico 
El presente proyecto aborda la modernización y unificación de múltiples extensiones legacy del entorno de escritorio GNOME mediante el diseño de una arquitectura modular compatible con GNOME Shell 50. 

El problema central radica en la fragilidad estructural del ecosistema de extensiones, el cual depende de APIs internas sujetas a cambios frecuentes, lo que genera obsolescencia. 

Se propone el desarrollo de una extensión unificada que sea: estrictamente modular, con bajo acoplamiento, que gestione de forma centralizada las señales, "lazy loading" y con control explícito del ciclo de vida de cada componente. 

El resultado esperado es una arquitectura extensible, modular, mantenible y optimizada, validada mediante métricas objetivas de rendimiento y estabilidad. 
* 2. Planteamiento técnico del problema
* 3. Objetivos
** Objetivos específicos
- 1. Separar estrictamente lógica y frontend.
- 2. Implementar gestión centralizada de señales.
- 3. implementación de un Frmework modular.
- 4. implementar lazy loading de módulos.
- 5. Validar consumo de CPU y memoria.
- 6. Documentar arquitectura interna.

** Objetivo general
Diseñar e implementar una arquitectura modular desacoplada que permita adaptar, integrar y optimizar extensiones legacy para garantizar su compatibilidad y estabilidad en GNOME 50, minimizando el impacto en el rendimiento y maximizando mantenibilidad.

La nueva extensión unificada integraría, de forma modular y configurable, los siguientes componentes:
*** Aylur's widgets (base conceptual)
#+CAPTION: Screenshot que muestra el mensaje "DISCONTINUED" por parte del desarrollador.
[[file:./img/aylurs.png]]

[[https://extensions.gnome.org/extension/5338/aylurs-widgets/][Aylur's Widgets]] fue compatible hasta GNOME 44 y actualmente está discontinuada. Su propuesta consistía en un conjunto amplio de widgets:
- Barra de batería
- Dashboard
- Modificación del DateMenu
- Reproductor multimedia
- Menú de encendido
- Indicador de espacios de trabajo
- Indicador de notificaciones
- Configuración de los Quick Settings
- Relor en el escritorio
La intención no es replicar todo sin criterio, sino: 
- Evaluar qué componentes siguen siendo relevantes en GNOME 50.
- Detectar cuáles han sido remplazados por mejoras nativas del sistema.
Rediseñar los módulos con una arquitectura más eficiente y mantenible.

[[https://github.com/Aylur/gnome-extensions/tree/legacy][Aquí el código fuente de la extension]].

#+CAPTION: Vista general de la configuración de la extensión
[[file:./img/aylurs2.png]]

**** Módulos prioritarios
***** Background Clock
[[file:./img/aylurs-clock.svg]]

Widget de reloj sobre el escritorio, similar al comportamiento de [[https://github.com/brndnmtthws/conky][conky]]. 

Permite: 
- Posicionamiento por layouts o coordenadas. 
- Personalización completa de tipografía, color, tamaño y sombras.
- Configuración del contenedor (background, padding, bordes, redondeado).
Problema detectado: degradación de rendimiento al entrar al overview.
Objetivos:
- Analizar conflictos con extensiones como [[https://extensions.gnome.org/extension/5263/gtk4-desktop-icons-ng-ding/][DING (Desktop Icons NG)]].
- Optimizar el renderizado evitando bloqueos en animaciones (overview).

***** Battery Bar
[[file:./img/aylurs-battery.png]]

Indicador alternativo de batería en el Top Bar.
Configuraciones: 
- Posición (izquieda, centrado, derecha).
- Visibilidad del ícono y porcentaje. 
- Dimensiones.
- Colores dinámicos configurables (normal, cargando, batería baja).
Tras revisar el código, considero que este módulo es de baja complejidad y alto impacto visual, ideal como uno de los primeros widgets a implementar.
***** Media Player
[[file:./img/aylurs-player.png]]

Controles multimedia integrados en el Top Bar. Incluye:
- Botón con información de pista.
 	- Activarlos o desactivarlos.
	- Posición en el Top Bar (centrado, izquierda o derecha).
	- Longitud máxima del texto.
	- Mostrar u ocultar ícono del reproductor.
	- Ícono simbólico o coloreado.
	- Posición del ícono.     
- Controles multimedia (anterior, pausa, siguiente).
	- Activarlos o desactivarlos.
	- Posición en el Top Bar (centrado, izquierda o derecha)
- Widget desplegable personalizable.
	- Limpiar caché
	- Reproductor preferido
	- Estilo: Normal, horizontal, compacto, label in cover, label in cover + vertical control, full.
	- Altura, ancho y redondez de la carátula del álbum
	- Mostrar u ocultar título y modificar su alineación. 
	- Mostrar u ocultar un slider de volumen y un botón de shuffle y loop.

Se estudiarán como referencia:
- [[https://extensions.gnome.org/extension/4470/media-controls][Media Controls]]
- [[https://extensions.gnome.org/extension/9184/advanced-media-controller][Advanced Media Controller]]

Estas extensiones agregan un widget simiar y son compatibles con versiones actuales de GNOME.
También tenemos esta otra "curiosidad":
- [[https://extensions.gnome.org/extension/9153/dock-media-player/][Dock Media Player]]

Objetivos:
- Evitar duplicidad entre Top Bar, notificación y Quick Settings (esta última la veremos más adelante). Unificando la experiencia.
- Diseñar un único backend MPRIS reutilizable.
***** Workspace Indicator 
[[file:./img/aylurs-workspace.svg]]

Indicador de espacios de trabajo. Este widget tenía más sentido en versiones anteriores a GNOME 45, cuando solo estaba el botón de actividades, ahora se incluye una píldora indicadora. Aun así, se puede:
- Ofrecer una alternativa más configurable, tomando como base [[https://extensions.gnome.org/extension/5090/space-bar/][Space Bar]], que ofrece un indicador de workspace similar al de waybar.
- Añade atajos de teclado para navegar rápidamente entre los workspaces (al estilo de un Window Manager Tiling.
- Añadir animaciones personalizadas.
[[file:./img/spacebar.png]]

***** Notification Indicator     
[[file:./img/aylurs-notify.svg]]

Indicador de notificaciones con contador numérico. 
Aunque GNOME ya incluye un indicador visual, no existe un contador de notificaciones. Este módulo aporta información cuantitativa adicional.
Podemos configurar:
- Posición en el Top Bar, izquierda, derecha, centrado.
- Offset.
- Estilo (íconos de apps o contador).
- Máxima cantidad de íconos.
- Ocultar/mostrar el contador.

***** Power Menu
[[file:./img/aylurs-power.png]]
Botón personalizable con diálogo de apagado. Baja complejidad de implementación y buena aceptación estética. Permite:
- Modificar la posición del ícono en la Top Bar: centrado, izquierda o derecha.
- Layout, 2x2 o 1x4 (grid de los botones de power).
- Redondez de los botones.
- Tamaño de los botones. 
- Padding de los íconos. 
- Espaciado.
- Dialog Background

**** Módulos secundarios o descartables
***** Dashboard
[[file:./img/aylurs-dashboard.png]]

Agrupa la mayoría de widgets en una "ventana de diálogo", accesible mediante un botón en el Top Bar o con un atajo de teclado. Este módulo es redundante, aunque puede ser útil si se desea una experiencia stock y poder acceder a los widgets en un panel que los agrupe.

***** QuickSettings y DateMenu Mod
[[file:./img/aylurs-quick-notify.svg]]

Permiten configurar los QuickSettings, el calendario y el panel de notificaciones. Estos dos componentes se descartan en su mayoría, más adelante se mostrará una extensión moderna que reemplazan estos módulos.

Partes rescatables:
- Monitor de recursos en los Quick Settings.
- Modificación del formato de hora/fecha. Se estudará como referencia: [[https://extensions.gnome.org/extension/4655/date-menu-formatter/][date menu format]].

*** Extensiones adicionales a integrar
**** Quick Text.
[[file:./img/quicktext.png]]

Extensión compatible hasta GNOME 47, no se le ha dado mantenimiento en los últimos dos años.
Mediante un atajo de teclado (por defecto <Super> + <Ctrl> + i, aunque es totalmente personalizable) podemos acceder a un cuadro de texto, el contenido que escribimos se almacena en algún archivo de texto plano de nuestra preferencia. Es útil para tomar notas rápidas, para luego convertirlas en tareas o eventos (un inbox en el método GTD).  Si usas vim, emacs, logseq u obsidian para la toma de notas y la organización personal, puede ser una extensión bastante útil. El nombre y la ruta de acceso del archivo de destino deben establecerse antes de utilizar la extensión y el archivo debe existir.

[[https://github.com/brainstormtrooper/quicktext][Aquí el código fuente]]

El objetivo inicial es restaurar la compatibilidad.

El objtivo futuro es inspirarse en herramientas como [[https://github.com/boerdereinar/copyous][Copyous]] y [[https://unclutterapp.com/][Unclutter]] para desarrollar:
- Historial de portapapeles.
- Vita desplegable estilo panel.

[[file:./img/unclutter.gif]]

**** Quick Settings Tweaks
[[file:./img/quicksettingstweaks.png]]

Proyecto activo compatible hasta GNOME 48. Permite la configuración de los Quick Settings y del Date Menu.

Repositorio: [[https://github.com/qwreey/quick-settings-tweaks][Quick Settings Tweaks]].

Propuesta:
- Integrar parcialmete su lógica.
- Evitar solapamientos innecesarios.
- Unficar backend de configuración.
- Mantener modularidad interna.

El objetivo es adaptar:
***** Widgets: 
****** Media widget
[[file:./img/quicksettingstweaks-media.png]]

Widget de control multimedia en los Quick Settings. Puede ser redundante, pues ya se tiene un widget similar en el top bar. Es conveniente agregar una opción de configuración que permita al usuario elegir entre el widget del top bar o de los Quick Settings.
****** Notification Widget
[[file:./img/quicksettingstweaks-notify.svg]]

Mueve las notificaciones debajo de los Quick Settings.
****** Weather Widget
[[file:./img/quicksettingstweaks-weather.png]]

Mueve el widget de tiempo debajo de los Quick Settings.

***** Layouts y configuraciones
- Cambiar el orden de los QuickSettings (ajustes rápidos).
- Cambiar el orden de los indicadores del sistema (Iconos del top bar, Wi-Fi, Volumen, etcétera).
- Cambiar el orden de Items del sistema (Botones arriba de los QuickSettings y de los slider.)
- Date Menu
  - Activar o desactivar el menú.
  - Ocultar/mostar caja izquierda (notificaciones)
  - Ocultar/mostrar caja derecha (calendario)
  - Overlay Mode: (cambia la animación al hacer clic en un toggle)
**** Panel Corners
[[file:./img/panel-corners.png]]

Proyecto comatible hasta GNOME 48. Se le ha dado mantenimiento hace un año. Añade al Top Bar esquinas redondeadas.      

[[https://github.com/aunetx/panel-corners][Aquí el respositorio]]
* 4. Arquitectura propuesta
** 4.1 Principios de diseño
- Separación de responsabilidades. 
- Bajo acoplamiento
- Alta cohesión
- Gestión explícita del ciclo de vida.
- Evitar dependencia directa de APIs internar con poca documentación.
** 4.2 Estructura modular 
#+BEGIN_SRC bash
extension/
  core/
    moduleLoader.js
    signalManager.js
    settingsManager.js
    logger.js
  modules/
    batteryBar/
    powerMenu/
    notificationIndicator/
    panelCorners/
    workspaceIndicator/
    mediaPlayer/
    dashboard/
    backgroundClock/
    quickText/
  utils/
    mprisService.js
    layoutHelpers.js
#+END_SRC
** 4.3 Core Framework
*** Module Loader
- Carga y descarga dinámica de módulos.
- Activación condicional según configuración.
- Gestión de dependencias internas.

*** Signal Manager
- Registro centralizado.
- Desconexión automática en disable().
- Prevención de memory leaks.

*** Settings Manager
- Wrapper sobre GSettings.
- Observadores desacoplados.
- Actualización reactiva controlada.

*** Logger
- Sistema de depuración condicional.
- Activación en modo desarrollo.
* 5. Estrategia de optimización

* 6. Métodología de validación
Se utilizarán métricas como:

- Consumo de CPU en estado idle.
- Uso de memoria con múltiples módulos activos.
- Fluidez de animación del Overview.
- Ausencia de memory leaks tras ciclos enable/disable.

Pruebas:

1. Activación individual por módulo.
2. Activación combinada.
3. Prueba con extensiones externas activas.
4. Stress test de señales repetitivas.

* 7. Roadmap de implementación
** Fase 0: Investigación (1 a 2 semanas)
Objetivos técnicos:

- Analizar cambios de API entre GNOME 44 → 50.
- Identificar breaking changes en GJS y GNOME Shell.
- Evaluar cambios en:
  - imports ESModules
  - señales y actores de Clutter
  - Quick Settings
  - Panel API
- Estudiar nuevas prácticas recomendadas.
- Mapear dependencias internas entre módulos.
- Definir arquitectura modular base.
- Definir contrato interno entre módulos (interfaces y responsabilidades).

Actividades:

- Auditoría de código actual.
- Identificación de puntos de acoplamiento fuerte.
- Diseño de:
  - Core Manager
  - Module Loader
  - Event Bus interno (si aplica)
- Definición de estrategia de lazy loading.

Entregables:

- Documento técnico de arquitectura.
- Diagrama de componentes.
- Lista priorizada de módulos.
- Plan de migración incremental.
** Fase 1: Núcleo mínimo viable (3 a 4 semanas)
Objetivo: Extensión funcional y estable en GNOME 50 con núcleo modular.

Implementar:
- Sistema de configuración unificado (GSettings centralizado).
- Loader modular (activación/desactivación dinámica).
- Battery Bar.
- Power Menu.
- Notification Indicator.
- Panel Corners.

Criterios técnicos:
- Compatibilidad total con GNOME 50 beta.
- Ausencia de errores críticos en journalctl.
- Sin bloqueos del Shell.
- Sin listeners globales innecesarios.
- Sin memory leaks detectables.

Prioridades:
- Estabilidad > nuevas funcionalidades.
- No degradar rendimiento del panel.
- Diseño desacoplado entre módulos.

Resultado esperado:

Extensión estable y modular en estado preliminar.
** Fase 2: Módulos interactivos (4 - 6 semanas)
Objetivo: Incorporar funcionalidades con mayor interacción y estado.

Implementar:
- Media Player (backend MPRIS unificado).
- Workspace Indicator.
- Dashboard simplificado.

Enfoque de desarrollo:
- Reutilización de código.
- Minimización de listeners globales.
- Gestión eficiente de señales.
- Optimización de redraw.
- Separación estricta entre lógica y UI.

Requisitos técnicos:
- Sin polling innecesario.
- Uso controlado de señales MPRIS.
- Desacoplamiento entre backend y frontend visual.
- Pruebas con múltiples extensiones activas.

Resultado esperado:
Sistema interactivo robusto sin impacto perceptible en rendimiento.
** Fase 3: Integración avanzada (4 semanas)
Objetivo: Extender capacidades sin comprometer estabilidad.

Implementar:
- Adaptación parcial de Quick Settings Tweak.
- Integración de Quick Text.
- Diseño unificado de preferencias.
- Refinamiento del Panel Corners (si requiere integración adicional).

Actividades técnicas:
- Refactor de preferencias para diseño consistente.
- Consolidación de esquema GSettings.
- Testing intensivo con:
  - múltiples extensiones activas
  - cambios dinámicos de configuración
  - reinicios de Shell

Criterios:
- Sin regresiones funcionales.
- Compatibilidad cruzada.
- Bajo consumo de memoria.

Resultado:
Extensión madura, integrada y coherente en UX.

** Fase 4: Optimización y refactor (2 semanas)
Objetivo: Consolidar calidad técnica antes de publicación estable.

Actividades:
- Profiling de rendimiento.
- Medición de consumo de memoria.
- Eliminación de código redundante.
- Reducción de acoplamientos innecesarios.
- Mejora de documentación técnica.
- Limpieza para publicación en extensions.gnome.org.

Herramientas:
- Looking Glass.
- journalctl.
- Instrumentación manual de tiempos críticos.

Criterios:
- Tiempo de carga optimizado.
- Bajo impacto en el render del panel.
- Código legible y mantenible.
** Fase 5: Post lanzamiento
Implementar progresivamente:
- Historia de portapapeles estilo Unclutter
- Mantener arquitectura modular
- Mantenimiento y actualización
* 8. Riesgos y desafios
- Cambios futuros en GNOME 51 o posteriores.
- Dependencia de APIs no documentadas.
- Complejidad acumulativa por integración múltiple. 
- Sobrecarga funcional si no se controla el alcance. Amplitud y dispersión: las extensiones que lo conforman son heterogéneas en propósito y complejidad. Esto puede dificultar la definición de un objetivo claro y acotado. Por ello, será fundamental adoptar un enfoque modular y establecer prioridades claras.

Se mitigarán mediante:
- Diseño modular estricto.
- Pruebas iterativas.
- Documentación constante.
- Priorización clara de módulos.
* 9. Resultados esperados
- Arquitectónicamente modular.
- Compatible con GNOME 50.
- Escalable.
- Mantenible.
- Publicable.
- Con base sólida para futuras versiones de GNOME.

** Métricas de Calidad
- Tiempo de activación < 200 ms.
- Sin errores críticos en journalctl.
- Sin bloqueos del Shell.
- Sin degradación visible en FPS.
- Código documentado y modular.

